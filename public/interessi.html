<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interessi</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            margin: 20px;
        }
        .result-table {
            width: 100%;
            border-collapse: collapse;
        }
        .result-table th, .result-table td {
            border: 1px solid #ddd;
            padding: 8px;
        }
        .result-table th {
            background-color: #f2f2f2;
        }
        .interesse-item {
            cursor: pointer;
            margin-right: 10px;
            display: inline-block;
            background-color: #f0f0f0;
            padding: 5px 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .selected-interesse {
            cursor: pointer;
            margin-right: 10px;
            display: inline-block;
            background-color: #d1ecf1;
            padding: 5px 10px;
            border-radius: 5px;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Interessi</h1>

    <div>
        <h2>Mostra interessi</h2>
        <button onclick="getInteressi()">Mostra gli interessi</button>
        <div id="listaInteressi"></div>
        <div id="interessiResult"></div>
    </div>

    <div>
        <h2>Corsi di Studio per Interesse</h2>
        <div id="selectedInteressi"></div>
        <button onclick="getCorsiPerInteressi()">Cerca</button>
        <div id="corsiInteresseResult"></div>
    </div>

</div>

<script>
    let selectedInteressi = [];

    async function getInteressi() {
        try {
            const response = await fetch(`/interessi`);
            if (!response.ok) {
                throw new Error('Errore nella richiesta al server');
            }
            const data = await response.json();
            console.log('Dati ricevuti:', data); // Log dei dati ricevuti per debug
            displayInteressi(data, 'interessiResult');
        } catch (error) {
            console.error('Errore:', error);
            document.getElementById('interessiResult').textContent = 'Errore durante la richiesta.';
        }
    }

    async function getCorsiPerInteressi() {
        try {
            const interessi = selectedInteressi.join('_');
            const response = await fetch(`/corsi-per-interesse?interessi=${encodeURIComponent(interessi)}`);
            if (!response.ok) {
                throw new Error('Errore nella richiesta al server');
            }
            const data = await response.json();
            displayResult(data, 'corsiInteresseResult');
        } catch (error) {
            console.error('Errore:', error);
            document.getElementById('corsiInteresseResult').textContent = 'Errore durante la richiesta.' + error;
        }
    }

    function displayInteressi(data) {
        const listaInteressiDiv = document.getElementById('listaInteressi');
        listaInteressiDiv.innerHTML = '';

        if (!data.results || !data.results.bindings || data.results.bindings.length === 0) {
            listaInteressiDiv.textContent = 'Nessun interesse trovato.';
            return;
        }

        const interessi = data.results.bindings.map(item => item.nome.value);

        interessi.forEach(interesse => {
            const interesseItem = document.createElement('div');
            interesseItem.textContent = interesse;
            interesseItem.className = 'interesse-item';
            interesseItem.addEventListener('click', () => {
                if (!selectedInteressi.includes(interesse)) {
                    selectedInteressi.push(interesse);
                    updateSelectedInteressi();
                }
            });
            listaInteressiDiv.appendChild(interesseItem);
        });
    }

    function updateSelectedInteressi() {
        const selectedInteressiDiv = document.getElementById('selectedInteressi');
        selectedInteressiDiv.innerHTML = '';

        selectedInteressi.forEach(interesse => {
            const interesseItem = document.createElement('div');
            interesseItem.textContent = interesse;
            interesseItem.className = 'selected-interesse';
            interesseItem.addEventListener('click', () => {
                selectedInteressi = selectedInteressi.filter(i => i !== interesse);
                updateSelectedInteressi();
            });
            selectedInteressiDiv.appendChild(interesseItem);
        });
    }

    function displayResult(data, elementId) {
        const resultDiv = document.getElementById(elementId);
        resultDiv.innerHTML = '';

        if (data.results.bindings.length > 0) {
            const table = document.createElement('table');
            table.className = 'result-table';
            const thead = document.createElement('thead');
            const tbody = document.createElement('tbody');

            const headerRow = document.createElement('tr');
            Object.keys(data.results.bindings[0]).forEach(key => {
                const th = document.createElement('th');
                th.textContent = key;
                headerRow.appendChild(th);
            });
            thead.appendChild(headerRow);

            data.results.bindings.forEach(row => {
                const tr = document.createElement('tr');
                Object.values(row).forEach(value => {
                    const td = document.createElement('td');
                    td.textContent = value.value;
                    tr.appendChild(td);
                });
                tbody.appendChild(tr);
            });

            table.appendChild(thead);
            table.appendChild(tbody);
            resultDiv.appendChild(table);
        } else {
            resultDiv.textContent = 'Nessun risultato trovato.';
        }
    }
</script>
</body>
</html>
