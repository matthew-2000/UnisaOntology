<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <title>Interessi</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }
        .container {
            margin: 20px;
        }

        ul {
            list-style-type: none;
            padding: 0;
        }

        li {
            padding: 5px 0;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Interessi Disponibili</h1>
    <div>
        <h2>Trova Corsi di Studio</h2>
        <input type="text" id="interests" name="interests" placeholder="Inserisci i tuoi interessi separati da virgola">
        <button id="toggle-interests" type="button">&#x25BC; Mostra tutti gli interessi</button>
        <ul id="interests-list" style="display: none;">
            <!-- Lista completa di interessi verrÃ  popolata dinamicamente -->
        </ul>
        <button type="submit" id="submit-interests">Trova Corsi</button>
    </div>

    <h2>Corsi di Studio Correlati:</h2>
    <ul id="courses-list"></ul>
</div>

<script>
    $(document).ready(function () {
        // Gestisce il caricamento degli interessi disponibili
        $.ajax({
            url: '/interessi',
            type: 'GET',
            dataType: 'json',
            success: function (data) {
                const interestsList = $('#interests-list');
                data.interests.forEach(interest => {
                    interestsList.append(`<li>${interest}</li>`);
                });
            },
            error: function (err) {
                console.error('Errore nel recupero degli interessi:', err);
            }
        });

        // Gestisce l'espansione e contrazione della lista di tutti gli interessi
        let interestsExpanded = false;
        $('#toggle-interests').on('click', function () {
            const interestsList = $('#interests-list');
            if (interestsExpanded) {
                interestsList.hide();
                $('#toggle-interests').html('&#x25BC; Mostra tutti gli interessi');
            } else {
                interestsList.show();
                $('#toggle-interests').html('&#x25B2; Nascondi interessi');
            }
            interestsExpanded = !interestsExpanded;
        });

        // Gestisce il click su un interesse nella lista completa
        $(document).on('click', '#interests-list li', function () {
            const interest = $(this).text().trim();
            const currentInterests = $('#interests').val() || '';

            if (!currentInterests.includes(interest)) {
                const updatedInterests = currentInterests.length > 0 ? `${currentInterests}, ${interest}` : interest;
                $('#interests').val(updatedInterests);
            }
        });

        // Gestisce l'invio del form per trovare i corsi
        $('#submit-interests').on('click', function (event) {
            event.preventDefault();
            const interests = $('#interests').val().split(',').map(interest => interest.trim());

            // Costruzione dell'URL GET con parametri
            const queryParams = interests.map(interest => `interests=${encodeURIComponent(interest)}`).join('&');
            const url = `/corsi-per-interesse?${queryParams}`;
            console.log(url);
            $.ajax({
                url: url,
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    $('#courses-list').empty();
                    data.courses.forEach(course => {
                        $('#courses-list').append(`<li><a href="${course}">${course}</a></li>`); // Link diretto all'URI del corso
                    });
                },
                error: function (err) {
                    console.error('Errore nel recupero dei corsi:', err);
                }
            });
        });
    });
</script>
</body>
</html>
